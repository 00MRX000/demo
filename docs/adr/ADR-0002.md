\# ADR-0002: Стратегия CI и инструменты DevSecOps



\*\*Дата:\*\* 2025-12-10

\*\*Статус:\*\* Accepted



\## 1. Контекст



\### 1.1. Цель CI

Целью является создание полностью автоматизированного и надежного конвейера непрерывной интеграции (CI), который гарантирует, что в ветку `main` попадает только код, прошедший все проверки качества и безопасности.



\### 1.2. Требования безопасности (Shift-Left)

В соответствии с методологией DevSecOps, проверки безопасности должны быть сдвинуты "влево" (Shift-Left), то есть максимально приближены к процессу разработки. Для этого необходимо интегрировать Secret Scanning, SAST и SCA непосредственно в пайплайн Pull Request.



\## 2. Решение



\### 2.1. CI-провайдер

Выбран \*\*GitHub Actions\*\* как нативный и тесно интегрированный инструмент в платформу GitHub, обеспечивающий простую настройку и автоматическую публикацию отчетов SARIF в Code Scanning.



\### 2.2. Этапы пайплайна и инструменты

| Этап | Инструмент | Цель | Политика |

| :--- | :--- | :--- | :--- |

| \*\*Build/Test\*\* | Docker, Pytest | Воспроизводимая сборка образа (`app:ci`) и выполнение unit-тестов. | Fail on test failure. |

| \*\*Quality Gate\*\* | Pre-commit | Проверка форматирования кода (`black`, `isort`) и линтинг до слияния. | Fail on linting errors. |

| \*\*Secret Scanning\*\* | Gitleaks | Поиск случайно закоммиченных токенов и паролей. | Fail on secret exposure. |

| \*\*SAST\*\* | Semgrep | Статический анализ кода на уязвимости (профиль OWASP Top 10). | Fail on critical findings. |

| \*\*SCA/Container Scan\*\* | Trivy | Сканирование зависимостей (SCA) и Docker-образа на уязвимости. | \*\*Fail on HIGH/CRITICAL severity.\*\* |



\### 2.3. Публикация артефактов

Для интеграции и отчетности используются следующие артефакты:

\* \*\*SARIF:\*\* Отчеты Gitleaks, Semgrep, и Trivy публикуются в формате SARIF для отображения в GitHub Code Scanning.

\* \*\*SBOM (CycloneDX):\*\* Генерируется с помощью Trivy для обеспечения прозрачности цепочки поставок ПО.



\## 3. Последствия



\* \*\*Плюсы:\*\* Резкое снижение риска попадания уязвимостей и секретов в ветку `main`. Обеспечение единообразного стиля кода.

\* \*\*Минусы:\*\* Увеличенное время выполнения CI (за счет добавления сканирования). Риск ложных срабатываний (false positives), требующих ручной настройки исключений.

\* \*\*Критерии пересмотра:\*\* Пересмотр ADR требуется при смене CI-провайдера, изменении ключевых инструментов DevSecOps, или изменении политики `fail-on`.



\## 4. Security Considerations



\* \*\*Secrets:\*\* Все токены для CI хранятся в GitHub Secrets и не заносятся в код. Gitleaks защищает от случайного коммита.

\* \*\*Supply Chain:\*\* Генерация SBOM обеспечивает прозрачность всех сторонних зависимостей, а Trivy сканирует эти зависимости на известные уязвимости (CVE).

